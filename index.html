<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å¤šç„¦ç‚¹ãƒ¬ãƒ³ã‚ºè¨ºæ–­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- noUiSlider CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.css" rel="stylesheet" />

  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f5f5;padding:20px;max-width:600px;margin:auto}
    h1{text-align:center;margin-bottom:0.3em}
    p{text-align:center;color:#555;font-size:0.95em}

    /* slider */
    #multi-slider.noUi-target{height:26px;margin:50px 0;background:#ddd;border-radius:20px;box-shadow:inset 0 4px 8px rgba(0,0,0,.25),inset 0 -2px 4px rgba(0,0,0,.1)}
    .noUi-handle{height:34px;width:34px;border-radius:50%;top:-5px;background:#fff;border:2px solid rgba(0,0,0,.35);box-shadow:0 4px 6px rgba(0,0,0,.45);transition:transform .1s}
    .noUi-handle:hover{transform:scale(1.12)}
    .noUi-tooltip{display:none!important}
    .noUi-connect{background:transparent}
    #multi-slider .noUi-connect:nth-child(1){background:#4caf50}
    #multi-slider .noUi-connect:nth-child(2){background:#2196f3}
    #multi-slider .noUi-connect:nth-child(3){background:#ffc107}
    #multi-slider .noUi-connect:nth-child(4){background:#e91e63}

    /* labels */
    #labels{position:relative;height:0}
    .segment-label{position:absolute;pointer-events:none;white-space:nowrap;transform:translate(-50%,-50%);text-shadow:0 1px 1px rgba(255,255,255,.9)}
    .name-label{font-size:1.3em;color:#000;font-weight:600}
    .pct-label{font-size:1em;color:#000}

    /* button */
    #confirm-btn{display:block;margin:180px auto 0;padding:12px 28px;font-size:1.1em;background:#1976d2;color:#fff;border:none;border-radius:8px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.3);transition:background .2s}
    #confirm-btn:hover{background:#1565c0}

    /* results */
    #results{margin-top:50px;font-size:1.05em}
    .result-item{margin:14px 0;opacity:0;transition:opacity .5s}
    .result-item.rank-1{font-size:1.4em;font-weight:700}
  </style>
</head>
<body>
  <h1>ğŸ‘ å¤šç„¦ç‚¹ãƒ¬ãƒ³ã‚ºè¨ºæ–­</h1>
  <p>ï¼“æœ¬ã®ãƒãƒ³ãƒ‰ãƒ«ã§ã€Œé®®æ˜ã• âœ é‹è»¢ âœ ãƒ‘ã‚½ã‚³ãƒ³ âœ èª­æ›¸ã€ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ±ºã‚ã€<br>ä¸‹ã® <strong>æ±ºå®š</strong> ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>

  <div id="multi-slider"></div>
  <div id="labels"></div>
  <button id="confirm-btn">æ±ºå®š</button>
  <div id="results"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.js"></script>
  <script>
    /* æ­£è¦åŒ–ã‚¹ã‚³ã‚¢: [contrast, driving, computer, reading] é † */
    const lensData=[
      {name:"FineVision HP",score:[21.72,12.99,16.49,25.00]},
      {name:"PanOptix",    score:[22.22,17.01,19.23,21.26]},
      {name:"Vivity",      score:[24.75,22.22,21.98,15.63]},
      {name:"Monofocal",   score:[25.00,25.00,13.73, 5.26]}
    ];

    const names=["é®®æ˜ã•","é‹è»¢","ãƒ‘ã‚½ã‚³ãƒ³","èª­æ›¸"];
    const slider=document.getElementById("multi-slider");
    const labelsEl=document.getElementById("labels");
    const resultsEl=document.getElementById("results");
    const btn=document.getElementById("confirm-btn");

    noUiSlider.create(slider,{start:[25,50,75],connect:[true,true,true,true],range:{min:0,max:100},step:1,behaviour:"drag",tooltips:[true,true,true]});

    /* ãƒ©ãƒ™ãƒ«æ›´æ–° */
    function renderLabels(vals){
      labelsEl.innerHTML="";
      const [a,b,c]=vals.map(Number);
      const seg=[a,b-a,c-b,100-c];
      let acc=0;
      seg.forEach((pct,i)=>{
        const center=acc+pct/2;
        // åç§°
        const nameSpan=document.createElement("span");
        nameSpan.className="segment-label name-label";
        nameSpan.style.left=center+"%";
        nameSpan.style.top=(slider.getBoundingClientRect().height/2+6)+"px";
        nameSpan.textContent=names[i];
        labelsEl.appendChild(nameSpan);
        // ï¼…
        const pctSpan=document.createElement("span");
        pctSpan.className="segment-label pct-label";
        pctSpan.style.left=center+"%";
        pctSpan.style.top=(slider.getBoundingClientRect().height/2+30)+"px";
        pctSpan.textContent=pct.toFixed(1)+"%";
        labelsEl.appendChild(pctSpan);
        acc+=pct;
      });
    }

    slider.noUiSlider.on("update",vals=>{
      renderLabels(vals);
      slider.querySelectorAll('.noUi-tooltip').forEach(t=>t.style.display='none');
    });

    /* è¨ºæ–­ */
    function diagnose(){
      resultsEl.innerHTML="";
      const [a,b,c]=slider.noUiSlider.get().map(Number);
      if(!(a<=b&&b<=c))return;
      const weights=[a,b-a,c-b,100-c].map(v=>v/100);
      const ranked=lensData.map(l=>{
        const score=l.score.reduce((sum,v,i)=>sum+v*weights[i],0);
        return {...l,total:score};
      }).sort((p,q)=>q.total-p.total).slice(0,3);

      ranked.forEach((l,i)=>{
        setTimeout(()=>{
          const div=document.createElement("div");
          div.className="result-item rank-"+(i+1);
          div.style.opacity="1";
          div.textContent=`${i+1}ä½: ${l.name} (ã‚¹ã‚³ã‚¢:${l.total.toFixed(2)})`;
          resultsEl.appendChild(div);
        },i*600);
      });
    }

    btn.addEventListener("click",diagnose);
    renderLabels([25,50,75]);
  </script>
</body>
</html>
