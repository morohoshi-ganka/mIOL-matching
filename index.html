<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å¤šç„¦ç‚¹ãƒ¬ãƒ³ã‚ºè¨ºæ–­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- noUiSlider ã®ã‚¹ã‚¿ã‚¤ãƒ« -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.css"
    rel="stylesheet"
  />

  <style>
    body { font-family: Arial, sans-serif; padding:20px; max-width:600px; margin:auto; }
    h1 { text-align:center; margin-bottom:0.2em; }
    p { text-align:center; color:#555; }

    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¸¯ã®ç«‹ä½“æ„Ÿ */
    #multi-slider.noUi-target {
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
      border-radius: 15px;
      height: 20px;
      margin: 30px 0;
    }
    /* ãƒãƒ³ãƒ‰ãƒ«ã®ç«‹ä½“æ„Ÿ */
    .noUi-handle {
      box-shadow: 0 2px 4px rgba(0,0,0,0.4);
      border-radius: 50%;
      height: 28px;
      width: 28px;
      top: -4px;
      background: #fff;
      border: 2px solid #888;
    }

    /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—éè¡¨ç¤º */
    .noUi-tooltip { display: none !important; }

    /* å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å€‹åˆ¥è‰²ã§å¡—ã‚‹ */
    .noUi-connect { background: transparent; }
    #multi-slider .noUi-connect:nth-child(1) { background: #4CAF50; }   /* é®®æ˜ã• */
    #multi-slider .noUi-connect:nth-child(2) { background: #2196F3; }   /* é‹è»¢ */
    #multi-slider .noUi-connect:nth-child(3) { background: #FFC107; }   /* ãƒ‘ã‚½ã‚³ãƒ³ */
    #multi-slider .noUi-connect:nth-child(4) { background: #E91E63; }   /* èª­æ›¸ */

    /* ãƒ©ãƒ™ãƒ«è¡¨ç¤ºç”¨ */
    #labels { position: relative; height: 0; }
    .segment-label {
      position: absolute;
      color: black; /* æ–‡å­—è‰²ã‚’é»’ã«å¤‰æ›´ */
      font-size: 0.9em;
      text-shadow: 0 1px 2px rgba(255,255,255,0.6); /* ç™½ã„ç¸å–ã‚Šã§å¯èª­æ€§ç¢ºä¿ */
      transform: translate(-50%, -50%);
      pointer-events: none;
      white-space: nowrap;
    }

    /* çµæœè¡¨ç¤º */
    #results { white-space: pre-wrap; margin-top:20px; font-size: 0.95em; }
  </style>
</head>
<body>
  <h1>ğŸ‘ å¤šç„¦ç‚¹ãƒ¬ãƒ³ã‚ºè¨ºæ–­</h1>
  <p>ï¼“æœ¬ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€Œé®®æ˜ã•â‡”é‹è»¢â‡”ãƒ‘ã‚½ã‚³ãƒ³â‡”èª­æ›¸ã€ã®ãƒãƒ©ãƒ³ã‚¹ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>

  <!-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æœ¬ä½“ -->
  <div id="multi-slider"></div>
  <!-- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåï¼‹ï¼…ãƒ©ãƒ™ãƒ«é…ç½®é ˜åŸŸ -->
  <div id="labels"></div>
  <!-- è¨ºæ–­çµæœ -->
  <pre id="results"></pre>

  <!-- noUiSlider ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.js"></script>
  <script>
    // æ­£è¦åŒ–æ¸ˆã¿ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ï¼ˆå„é …ç›®Max25ï¼‰
    const lensData = [
      {name:"FineVision HP", score:[25.00,12.99,16.49,21.72]},
      {name:"PanOptix",     score:[21.26,17.01,19.23,22.22]},
      {name:"Vivity",       score:[15.63,22.22,21.98,24.75]},
      {name:"Monofocal",    score:[ 5.26,25.00,13.73,25.00]},
    ];

    const slider = document.getElementById('multi-slider');

    // 1æœ¬ã®å¸¯ã«3ã¤ã®ãƒãƒ³ãƒ‰ãƒ«ã€4ã¤ã®ã‚³ãƒã‚¯ãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
    noUiSlider.create(slider, {
      start: [25, 50, 75],
      connect: [true, true, true, true],
      range: { min: 0, max: 100 },
      step: 1,
      behaviour: 'drag',
      tooltips: [true, true, true]
    });

    const labelsEl = document.getElementById('labels');
    const resultsEl = document.getElementById('results');
    const names = ['é®®æ˜ã•','é‹è»¢','ãƒ‘ã‚½ã‚³ãƒ³','èª­æ›¸'];

    // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåï¼‹ï¼…ãƒ©ãƒ™ãƒ«æ›´æ–°
    function updateLabels(vals) {
      labelsEl.innerHTML = '';
      const a = +vals[0], b = +vals[1], c = +vals[2];
      const seg = [a, b-a, c-b, 100-c];
      let acc = 0;
      seg.forEach((pct,i)=>{
        const x = acc + pct/2;
        const span = document.createElement('span');
        span.className = 'segment-label';
        span.style.left = x + '%';
        span.style.top = (slider.getBoundingClientRect().height/2 + 10) + 'px';
        span.textContent = names[i] + ' ' + pct.toFixed(1) + '%';
        labelsEl.appendChild(span);
        acc += pct;
      });
    }

    // TOP3 è¨ºæ–­çµæœæ›´æ–°
    function updateResults(vals) {
      const a = +vals[0], b = +vals[1], c = +vals[2];
      if (!(a <= b && b <= c)) return;

      const raw = [a, b-a, c-b, 100-c];
      const total = raw.reduce((s,x)=>s+x,0);
      const w = raw.map(x=>x/total);

      const scored = lensData.map(l=>{
        const s = l.score.reduce((sum,v,i)=>sum + v*w[i],0);
        return {name:l.name, score:s};
      })
      .sort((p,q)=>q.score-p.score)
      .slice(0,3);

      let out = 'ã€ãŠã™ã™ã‚ãƒ¬ãƒ³ã‚ºTOP3ã€‘\n';
      scored.forEach((l,i)=>{
        out += `\nğŸ… ç¬¬${i+1}ä½: ${l.name}ï¼ˆã‚¹ã‚³ã‚¢:${l.score.toFixed(2)}ï¼‰`;
      });
      resultsEl.textContent = out;
    }

    // æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
    slider.noUiSlider.on('update', (values) => {
      // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã¯éè¡¨ç¤º
      slider.querySelectorAll('.noUi-tooltip').forEach(t=>t.style.display='none');
      updateLabels(values);
      updateResults(values);
    });

    // åˆæœŸè¡¨ç¤ºè¨­å®š
    slider.noUiSlider.set([25,50,75]);
  </script>
</body>
</html>
